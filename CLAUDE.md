# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Purpose

Agent Harness - Research repository for building deterministic, token-efficient AI agents using official Anthropic Skills pattern. Single orchestrator + skills library (NOT multi-agent).

## Root Directory Structure

| File/Folder | Purpose | Update When |
|-------------|---------|-------------|
| **DESIGN-v2.md** | Current architecture spec (4-layer: determinism, orchestration, enforcement, learning) | Architecture changes |
| **.skills/** | Skills library - modular workflows loaded on-demand | Adding/updating skills |
| **.skills/README.md** | Skills catalog + maintenance guide | Skill changes |
| **.archive/** | Deprecated patterns (DESIGN.md, coordination/, old docs) | Deprecating code |
| **.mcp.json** | MCP server config (context7, token-efficient) | Adding MCP servers |
| **.claude/** | Claude Code config + progress tracking | Session state changes |
| **REFERENCE.md** | External research links | New sources found |
| **SUMMARY.md** | Session summaries (deprecated - use /summary skill) | - (legacy) |

## Skills Library (.skills/)

Each skill follows official Anthropic pattern:
```
skill-name/
├── SKILL.md          # YAML frontmatter + workflow (<5k words)
├── scripts/          # Executable code (0 tokens when run)
├── references/       # Docs loaded on-demand
└── assets/           # Templates (output only)
```

**Critical**: SKILL.md `description` field is PRIMARY trigger - "Use when..." must be in frontmatter, not body.

## MCP Servers

Configured in `.mcp.json`:

| Server | Purpose | Use When |
|--------|---------|----------|
| **context7** | Fetch up-to-date docs for any library | Checking GitHub repos, needing latest API docs |
| **token-efficient** | CSV/log processing, code execution (98% token savings) | Processing >50 items, large data files |

**context7 usage** (for GitHub repo/library docs):
1. `resolve-library-id` → Get library ID from package name
2. `get-library-docs` → Fetch latest docs + code examples

## Session Progress

`.claude/progress/` tracks state across sessions:
- `state.json` - Current state (START/INIT/IMPLEMENT/TEST/COMPLETE)
- `feature-list.json` - Features being implemented
- `summary/` - Session summaries (generated by /summary skill)

## When to Update What

| Action | Files to Update |
|--------|-----------------|
| Add new skill | Use `skill-creator` skill first (pattern compliance), then `.skills/<name>/SKILL.md`, `.skills/README.md` |
| Change architecture | `DESIGN-v2.md` |
| Deprecate pattern | Move to `.archive/` with note |
| Find new research | Add to `REFERENCE.md` |
| Add MCP server | `.mcp.json` |
| Learn new pattern | Use `skill-creator` skill to create/update skill |
| Check external library/GitHub repo | Use `context7` MCP (`resolve-library-id` → `get-library-docs`) |
